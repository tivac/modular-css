# Force a VM instead of Docker, some tests that depend on the FS fail otherwise
sudo: required

# don't build tags, it's redundant
if: tag IS blank

# Environment setup
language: node_js
node_js:
- node
- '8'
- '6'

# https://docs.travis-ci.com/user/customizing-the-build/#Fast-Finishing
matrix:
  fast_finish: true

# keep the npm cache around to speed up installs
cache:
  directories:
  - "$HOME/.npm"

# Set up npm 5 for installs (npm 6 seems busted atm)
before_install:
 - npm config set loglevel warn
 - npm install --global npm@5

install:
- npm ci
- lerna exec -- npm ci

script:
- npm test -- --coverage --verbose --ci

# Disabling because danger seems broken atm?
# after_script:
# - npm run danger

# travis buddy adds comments with travis failures to PRs
notifications:
  webhooks: https://www.travisbuddy.com/
  on_success: never
