<style>
.output {
    composes: column from "./repl.css";

    grid-area: output;

    position: relative;
}
</style>

<div class="{css.output}">
    <CodeMirror config={cmconfig} ref:codemirror/>
</div>

<script>
import { dedent } from "dentist";

import store from "./store.js";
import listen from "./listen.js";

export default {
    components : {
        CodeMirror : "./codemirror.html",
    },

    store : () => store,

    data : () => ({
        cmconfig : {
            readOnly : true,
        }
    }),

    oncreate() {
        const { loading } = this.get();

        listen(this.refs.codemirror, "codemirror", ({ codemirror }) => {
            // Update output editor when css changes
            listen(this.store, [ "css", "compositions" ], ({ css, compositions }) => {
                codemirror.setValue(dedent(`
                    /* CSS OUTPUT */
                    ${css}
                    
                    /* CLASS COMPOSITIONS */
                    /**
                    ${JSON.stringify(compositions, null, 4)}
                    **/
                `));
            });
        }, { init : false });
    },
};
</script>
