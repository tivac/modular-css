<style>
.output {
    composes: column from "../site.css";

    grid-area: output;

    position: relative;
}
</style>

<div class="{css.output}">
    <CodeMirror config={cmconfig} {input} ref:codemirror/>
</div>

<script>
import store from "./store.js";
import listen from "./listen.js";

const header = "/* CSS OUTPUT */";

export default {
    components : {
        CodeMirror : "./codemirror.html",
    },

    store : () => store,

    data : () => ({
        input : header,
        cmconfig : {
            readOnly : true,
        }
    }),

    oncreate() {
        const { loading } = this.get();

        // Update output editor when css changes
        listen(this.refs.codemirror, "codemirror", ({ codemirror }) => {
            listen(this.store, [ "css", "compositions" ], ({ css, compositions }) => {
                this.set({
                    input : [
                        header,
                        css,
                        "",
                        "/* CLASS COMPOSITIONS */",
                        "/**",
                        JSON.stringify(compositions, null, 4),
                        "**/",
                    ].join("\n")
                });
            });
        }, { init : false });
    },
};
</script>
